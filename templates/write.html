<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Write</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <noscript>
        <h3>
         For functionality of this site it is necessary to enable JavaScript.
         Here are the <a href="http://www.enable-javascript.com/" target="_blank">
         instructions how to enable JavaScript in your web browser</a>.
       </h3><hr/>
      </noscript>

      <form  method="post" action="save">
          <div class="form-group col-sm-6">
            <label>Message</label>
            <textarea id="plain-message"  class="form-control"  required rows="5"></textarea>
            <button   id="encrypt-button" class="btn btn-primary" type="button" >&raquo; Encrypt</button>
          </div> 
          <div class="form-group col-sm-6" id="encMessageGroup" style="display:none">
            <label>Encrypted message</label>
            <textarea id="encMessage" class="form-control" readonly name="encMessage" rows="5" ></textarea>
            <button id="send-button"  class="btn btn-success" type="submit" >&raquo; Send</button>
          </div> 
      </form>
    </div>

    
    <script src="js/jquery-2.1.3.min.js"></script>
    <script src="js/openpgp.min.js"></script>
    <script src="js/key.js"></script>
    
    <script>   
    $( document ).ready(function() {
        var publicKey = window.openpgp.key.readArmored(pub_key);
        $("#encrypt-button").click(function( event ) {
          var data = $.trim($("#plain-message").val());
          if(data.length == 0) {
            alert("message is empty. write something...");
            return;
          }
          
          window.openpgp.encryptMessage(publicKey.keys, data).then(function(pgpMessage) {
              $("#encMessage").val(pgpMessage);
              $("#encMessageGroup").show();
              $('#send-button').prop('disabled', false);
          }).catch(function(error) {
            alert("ERROR: "+error);
          });
        });
        $("#plain-message").bind('input',function(){
          $("#encMessage").val(''); 
          $('#send-button').prop('disabled', true);
        });
    });
    </script>
    
  </body>
</html>
